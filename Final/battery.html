<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>位置與電量回報</title>

<style>
body {
  font-family: "Microsoft JhengHei", sans-serif;
  background: #f4f6f8;
  text-align: center;
  padding-top: 40px;
}
.box {
  background: white;
  width: 360px;
  margin: auto;
  padding: 20px;
  border-radius: 10px;
}
button {
  padding: 8px 14px;
  border: none;
  border-radius: 6px;
  background: #007bff;
  color: white;
  cursor: pointer;
  margin: 4px;
}
pre {
  background: #eee;
  padding: 10px;
  border-radius: 6px;
  text-align: left;
  white-space: pre-wrap;
  word-break: break-all;
}
</style>
</head>

<body>

<div class="box">
  <h3>位置與電量回報</h3>

  <button onclick="getInfo()">取得資訊</button>
  <button onclick="shareToApp()">分享至應用程式</button>
  <button onclick="copyText()">複製回報文字</button>

  <pre id="output">尚未取得資料</pre>
</div>

<script>
let shareText = "";

function getInfo() {
  document.getElementById("output").textContent =
    "定位中，請允許定位權限";

  navigator.geolocation.getCurrentPosition(
    function (pos) {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const mapUrl = "https://www.google.com/maps?q=" + lat + "," + lon;

      if (navigator.getBattery) {
        navigator.getBattery().then(function (battery) {
          const percent = Math.round(battery.level * 100);
          makeText(mapUrl, percent, lat, lon);
        }).catch(function () {
          makeText(mapUrl, null, lat, lon);
        });
      } else {
        makeText(mapUrl, null, lat, lon);
      }
    },
    function () {
      document.getElementById("output").textContent =
        "無法取得位置，請確認已允許定位";
    },
    {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0
    }
  );
}

function makeText(mapUrl, battery, lat, lon) {

  if (battery === null) {
    shareText =
  "我目前的位置：\n" +
  mapUrl + "\n\n" +
  "經緯度：" + lat + ", " + lon + "\n" +
  "電量狀態不予存取，不過跟您回報我目前很安全!";
    document.getElementById("output").textContent = shareText;
    return;
  }

  let note = "";

  if (battery >= 50) {
    note = "電量充足，可以保持聯絡";
  } else if (battery >= 20) {
    note = "電量稍低，仍可正常通訊";
  } else {
    note = "電量焦慮了，但我人很安全，不用擔心";
  }

  shareText =
    "我目前的位置：\n" +
    mapUrl + "\n\n" +
    "電量剩餘：" + battery + "%\n" +
    "備註：" + note;

  document.getElementById("output").textContent = shareText;
}

function shareToApp() {
  if (!shareText) {
    alert("請先取得資訊");
    return;
  }

  if (navigator.share) {
    navigator.share({
      title: "位置回報",
      text: shareText
    });
  } else {
    copyText();
  }
}

function copyText() {
  if (!shareText) {
    alert("請先取得資訊");
    return;
  }
  navigator.clipboard.writeText(shareText);
  alert("已複製");
}
</script>

</body>
</html>
